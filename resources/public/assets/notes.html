<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2017-02-01 Wed 19:52 -->
<meta  http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta  name="viewport" content="width=device-width, initial-scale=1" />
<title>Notes on CLJS Application</title>
<meta  name="generator" content="Org-mode" />
<meta  name="author" content="T. Spoon" />
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: visible;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline;}
  pre.src-sh:before    { content: 'sh'; }
  pre.src-bash:before  { content: 'sh'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-R:before     { content: 'R'; }
  pre.src-perl:before  { content: 'Perl'; }
  pre.src-java:before  { content: 'Java'; }
  pre.src-sql:before   { content: 'SQL'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  /*]]>*/-->
</style>
<style>pre.src {background-color: #303030; color: #e5e5e5;}</style>
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2013 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
</head>
<body>
<div id="content">
<h1 class="title">Notes on CLJS Application</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#orgheadline1">1. Build Notes:</a></li>
<li><a href="#orgheadline5">2. App Notes:</a>
<ul>
<li><a href="#orgheadline2">2.1. Intent</a></li>
<li><a href="#orgheadline3">2.2. Design</a></li>
<li><a href="#orgheadline4">2.3. Libraries</a></li>
</ul>
</li>
<li><a href="#orgheadline11">3. Usage:</a>
<ul>
<li><a href="#orgheadline6">3.1. Select a file</a></li>
<li><a href="#orgheadline7">3.2. Load TADMUDI</a></li>
<li><a href="#orgheadline8">3.3. Select a Path</a></li>
<li><a href="#orgheadline9">3.4. Render Charts</a></li>
<li><a href="#orgheadline10">3.5. Interact with the Data</a></li>
</ul>
</li>
<li><a href="#orgheadline17">4. Pending Features</a>
<ul>
<li><a href="#orgheadline12">4.1. More Paths</a></li>
<li><a href="#orgheadline13">4.2. More Charts</a></li>
<li><a href="#orgheadline14">4.3. Smarter Reactivity</a></li>
<li><a href="#orgheadline15">4.4. More local state</a></li>
<li><a href="#orgheadline16">4.5. Better UI / More useful UI? / Better Dashboard?</a></li>
</ul>
</li>
<li><a href="#orgheadline18">5. Bugs</a></li>
</ul>
</div>
</div>
<p>
Rick + Craig, 
</p>


<div id="outline-container-orgheadline1" class="outline-2">
<h2 id="orgheadline1"><span class="section-number-2">1</span> Build Notes:</h2>
<div class="outline-text-2" id="text-1">
<p>
I figured out the problem, and it was my fault.  
I had a dependency on google charts (which I was using earlier) that was being pulled 
in externally in the .html file, rather than via the build system.  I shimmed it back in for the moment.
After that, everything works for the minified, deployed build of the app. 
</p>
</div>
</div>

<div id="outline-container-orgheadline5" class="outline-2">
<h2 id="orgheadline5"><span class="section-number-2">2</span> App Notes:</h2>
<div class="outline-text-2" id="text-2">
<p>
The application is a dumb concept piece for how to explore a database of marathon runs,
stemming from the conversations between all of us.  Craig's current app is in VBA/excel, 
but I offer this (again, alpha / janky) example as a possible way forward. 
I'll clean up the source and push it out as a repository (probably under the geldersoft site) in the near future. 
I'm interested in copping some of the research into little offline data/project viewers for MARATHON,
possibly as re-usable components for a browser-based interface in the far flung future.
</p>
</div>

<div id="outline-container-orgheadline2" class="outline-3">
<h3 id="orgheadline2"><span class="section-number-3">2.1</span> Intent</h3>
<div class="outline-text-3" id="text-2-1">
<p>
I'm still working on this, but the general idea is to provide an interactive data exploration / comparison 
tool to enable analysts to engage in quick what-if scenarios related to cost/benefit analyses.
</p>
<ul class="org-ul">
<li>The supporting data for said analyses is either static (i.e. computed algebraically), or 
dynamic, derived from simulation output.</li>
<li>In either case, if we don't plan on providing the client with the means to simulate on-demand, 
we can provide a useful set of experimental runs (or calculated algebraic results) wrapped behind 
the facade of a queryable database.</li>
<li>The database provides a collection of performance metrics across combinations of:
<ul class="org-ul">
<li>ac supply</li>
<li>rc supply</li>
<li>SRC</li>
<li>demand scenario</li>
<li>rotational policy</li>
<li>surge period</li>
</ul></li>
<li>With the primary responses:
<ul class="org-ul">
<li>Fill  (% demand satisfaction).</li>
<li>Surplus (Delta between available supply and supply demanded).</li>
</ul></li>
</ul>

<p>
If we compute the supporting data ahead of time by performing many simulation experiments over a 
set of design points that "cover" the factors, we can use simple interpolation schemes to provide 
a lightweight, portable means for interacting with the response surface(s).
</p>

<p>
By juxtaposing points on the response surface(s), defind by user queries, analysts can explore the 
surfaces by changing factors like AC/RC supply.  Changes are then interpolated and projected live 
so that the user can explore the implications of trade-offs.
</p>

<p>
Currently, bar-charts and heat-map facets are used to provide two different views of the data.  
Other visualization schemes may be compelling, and with the tech stack in use, we have access to 
a bevy of custom techniques.  There is still a question of utility, and practicaly, that we are 
actively exploring.
</p>
</div>
</div>

<div id="outline-container-orgheadline3" class="outline-3">
<h3 id="orgheadline3"><span class="section-number-3">2.2</span> Design</h3>
<div class="outline-text-3" id="text-2-2">
<p>
The application is intended to be either served, or stored on a local filesystem.  In either case, the 
web-browser is directed to open the index.html, which serves as the entry-point for the app. 
</p>

<p>
If you look at the index.html, there's not much to the app.  Just a single div tag labeled "reagent-app".
That, and a solitary javascript tag reference.  
</p>

<p>
The big idea here is that everything is handled in ClojureScript, using what looks like native clojure code to 
define reactive web pages. Clojure(Script) does the bulk of the heavy lifting for data processing, offloading
visualization work to the Vega library.  The advantage here is obvious: we can leverage our familiarity with 
clojure - and any existing non-jvm specific clojure libaries - to define our application.  Combined with an 
excellent build system and the lack of web-specific features (like the need to learn HTML, CSS, etc.), we 
can "live" in ClojureScript - for the most part - and simply use the browser as a renderer.  Combined with 
the interactive browser-based REPL experience and auto-compilation provided by FigWheel, this is a compelling
means for building portable client-side applications.
</p>

<p>
So, we have a simple, single-page application that can be loaded (even from IE), and run as if it were a 
client-side app.  This maintains the browser sandboxing, and still lets the user do things we're using 
Excel for (namely client-side psuedo applications&#x2026;).  Currently, the application operates on local 
tab-delimited text files, and merely provides interactive views of the data.
</p>
</div>
</div>

<div id="outline-container-orgheadline4" class="outline-3">
<h3 id="orgheadline4"><span class="section-number-3">2.3</span> Libraries</h3>
<div class="outline-text-3" id="text-2-3">
<p>
I ended up traversing multiple libraries for this, starting with google Closure for web controls 
(don't recommend going this route), then moving on to a combination of reagent 
(for data management/reactive state), Vega (for charting, started out with highcharts), 
and re-com (a set of pre-baked components and controls built around reagent). 
During the course, I actually tangled with Google Charts, and HighCharts.
</p>

<ul class="org-ul">
<li>I now know how to effectively pull libraries in via leiningen, and how to wrap stateful  
"components" via reagent.</li>
<li>Interop with JavaScript is no longer a burden, although it is somewhat different than Java interop.</li>
<li>Understand the subtle differences between clojure/cljs.</li>
<li>Understand the build-system and tooling for deploying stand-alone single-page applications and static 
websites.</li>
</ul>
</div>
</div>
</div>

<div id="outline-container-orgheadline11" class="outline-2">
<h2 id="orgheadline11"><span class="section-number-2">3</span> Usage:</h2>
<div class="outline-text-2" id="text-3">
</div><div id="outline-container-orgheadline6" class="outline-3">
<h3 id="orgheadline6"><span class="section-number-3">3.1</span> Select a file</h3>
<div class="outline-text-3" id="text-3-1">
<p>
When you open the page, there's a file-selector asking for a "tadmudi file.: 
</p>
<ul class="org-ul">
<li>This is a simple table of run data, ideally experiments (MARATHON runs) across combinations of ac/rc supply,
policy, demand, and measures.</li>
</ul>
</div>
</div>

<div id="outline-container-orgheadline7" class="outline-3">
<h3 id="orgheadline7"><span class="section-number-3">3.2</span> Load TADMUDI</h3>
<div class="outline-text-3" id="text-3-2">
<p>
When a local file is selected (the aforementioned sampledata, for example&#x2026;),
the user (currently) selects the "load tadmudi" button.  
</p>
<ul class="org-ul">
<li>This parses the file and builds an in-memory database from it.</li>
<li>Future iterations will just load the file after selection is made and eliminate the button entirely.</li>
</ul>
</div>
</div>

<div id="outline-container-orgheadline8" class="outline-3">
<h3 id="orgheadline8"><span class="section-number-3">3.3</span> Select a Path</h3>
<div class="outline-text-3" id="text-3-3">
<p>
From here, a blank "path" indicator should pop up, along with a drop-down dialogue named "SRC".  
</p>
<ul class="org-ul">
<li>This is reactive component I built for "walking" a path into the db.</li>
<li>As the user selects an item at the current path into the db, the change is reflected in the path string.</li>
<li>A new drop-down box appears with the choices of the next segment in the path.</li>
<li>Currently, if you alter an earlier choice, the path is truncated and later choices (drop down menus) are removed.</li>
</ul>

<p>
The goal is a to define a path to a collection of samples in the database (a map of maps or tree), where samples are ordered 
according to groups defined by the path keys.
</p>
<ul class="org-ul">
<li>For example, our first level provides choices for "SRC" values.</li>
<li>Then "Demand", etc.</li>
<li>The leaves of the tree contain a collection of records, of which the "path" is equivalent to a compound key for grouping.</li>
<li>If we "get-in" the database using the path as a sequence of keys, we return the sampled records.</li>
</ul>

<p>
After you define a path to a collection of samples in the database, a couple of sliders will pop up.   
</p>
<ul class="org-ul">
<li>Currently, the app expects us to make an initial selection for ac/rc supply (the last piece of the path / last dropdown).</li>
</ul>
</div>
</div>

<div id="outline-container-orgheadline9" class="outline-3">
<h3 id="orgheadline9"><span class="section-number-3">3.4</span> Render Charts</h3>
<div class="outline-text-3" id="text-3-4">
<p>
From there, you can click the render-charts button.
</p>
<ul class="org-ul">
<li>This will populate an interactive bar chart and a series of heatmaps.</li>
<li>Heatmaps show an interpolated response surface derived from the path in the db for all AC/RC mixtures (currently only for the current path).</li>
<li>BarCharts plot the measure of the current path (say fill), while adding trends for neighboring samples:
<ul class="org-ul">
<li>Neighbors are currently defined as other paths with identical segments except for the Policy key.</li>
<li>Trends correspond to policies.</li>
<li>Trends only display for one path/SRC at the moment.</li>
</ul></li>
</ul>
</div>
</div>


<div id="outline-container-orgheadline10" class="outline-3">
<h3 id="orgheadline10"><span class="section-number-3">3.5</span> Interact with the Data</h3>
<div class="outline-text-3" id="text-3-5">
<p>
At this point, you can move the AC/RC sliders, where changing the sliders will cause:
</p>
<ul class="org-ul">
<li>A reflection in the bars as data is dynamically updated. 
<ul class="org-ul">
<li>Different values for the AC/RC mixture are fixed, and the bars are updated.</li>
<li>Presents a "local" view of the changes in response to AC/RC supply.</li>
</ul></li>
<li>A moving "cursor" on the surfaces, represented by a black-outlined cell.
<ul class="org-ul">
<li>the "cursor" is moved around the surface to reflect the current AC/RC mix.</li>
<li>Provides a "global" view of the current mixture, related to all possible mixtures across multiple 
juxtaposed response surfaces (one for each period currently).</li>
</ul></li>
</ul>
</div>
</div>
</div>

<div id="outline-container-orgheadline17" class="outline-2">
<h2 id="orgheadline17"><span class="section-number-2">4</span> Pending Features</h2>
<div class="outline-text-2" id="text-4">
</div><div id="outline-container-orgheadline12" class="outline-3">
<h3 id="orgheadline12"><span class="section-number-3">4.1</span> More Paths</h3>
<div class="outline-text-3" id="text-4-1">
<p>
Original development focused on a global database, with a corresponding global path.
It makes sense to have multiple paths, each with their own widgets and sampled data and charts.
The general mechanism is in place for this to work quite easily, we just need to refactor.
It'd also be nice to allow users to save and edit paths, via some modal focus.
</p>
</div>
</div>

<div id="outline-container-orgheadline13" class="outline-3">
<h3 id="orgheadline13"><span class="section-number-3">4.2</span> More Charts</h3>
<div class="outline-text-3" id="text-4-2">
<p>
Vega is great for defining specifications, typically taken from examples, and then building 
custom charts based on the template. 
However, it takes time to learn to use "vega" operations, and speak its special grammar.
My approach - at the moment - is to find a spec that looks like what I want, then do 
most of the work in Vega to generate complex plots.
</p>
<ul class="org-ul">
<li>Say, a faceted heatmap with an interactive cursor.</li>
</ul>
<p>
This is great, but I'm not able to customize charts super rapidly yet.
We could explore 3d plots, scatter plots, scatter matrices, etc.
I'd also like to get interactive filtering working and turned on.
</p>
</div>
</div>

<div id="outline-container-orgheadline14" class="outline-3">
<h3 id="orgheadline14"><span class="section-number-3">4.3</span> Smarter Reactivity</h3>
<div class="outline-text-3" id="text-4-3">
<p>
Things like auto-charting or auto-loading vs. having to press buttons.
Using channels to decouple and communicate would probably help this even more.
</p>
</div>
</div>

<div id="outline-container-orgheadline15" class="outline-3">
<h3 id="orgheadline15"><span class="section-number-3">4.4</span> More local state</h3>
<div class="outline-text-3" id="text-4-4">
<p>
State is fairly globalized in 2 atoms.  May need to rethink this.
</p>
</div>
</div>

<div id="outline-container-orgheadline16" class="outline-3">
<h3 id="orgheadline16"><span class="section-number-3">4.5</span> Better UI / More useful UI? / Better Dashboard?</h3>
<div class="outline-text-3" id="text-4-5">
<p>
I'm still struggling to find out how clients are using this. 
I think there is opportunity for providing some optimal points or summarized data 
that would obviate the need to interactively "explore" the data so much. 
</p>
</div>
</div>
</div>

<div id="outline-container-orgheadline18" class="outline-2">
<h2 id="orgheadline18"><span class="section-number-2">5</span> Bugs</h2>
<div class="outline-text-2" id="text-5">
<p>
If you render charts, and change the path, you must render again to see new charts.
Any interaction with the sliders will cause graphical errors and the data will not 
update properly.  This is a problem with state-management, and is tedious but not hard 
to solve. If this happens, just reload the app and start over.
</p>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="date">Date: 1 Feb 2017</p>
<p class="author">Author: T. Spoon</p>
<p class="date">Created: 2017-02-01 Wed 19:52</p>
<p class="validation"><a href="http://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
